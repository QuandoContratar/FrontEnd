<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Upload de Curr√≠culos - Quando Previd√™ncia">
    <meta name="author" content="">

    <title>Upload de Curr√≠culos - Quando Previd√™ncia</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="img/relogio_icone_quando_previdencia.png" type="image/png">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <style>
        :root {
            --roxo-principal: #7c3aed;
            --roxo-escuro: #5b21b6;
            --roxo-claro: #ede9fe;
            --roxo-hover: #a78bfa;
        }

        .sidebar-brand-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .bg-gradient-primary {
            background: linear-gradient(135deg, var(--roxo-principal) 0%, var(--roxo-escuro) 100%) !important;
        }

        .btn-primary {
            background-color: var(--roxo-principal);
            border-color: var(--roxo-principal);
        }

        .btn-primary:hover {
            background-color: var(--roxo-escuro);
            border-color: var(--roxo-escuro);
        }

        .text-primary {
            color: var(--roxo-principal) !important;
        }

        .page-title {
            color: var(--roxo-escuro);
            font-weight: 600;
        }

        .upload-area {
            border: 3px dashed #d1d3e2;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            background: #f8f9fc;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-area:hover {
            border-color: var(--roxo-principal);
            background: var(--roxo-claro);
        }

        .upload-area.dragover {
            border-color: var(--roxo-principal);
            background: var(--roxo-claro);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--roxo-principal);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--roxo-escuro);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .upload-formats {
            color: #6c757d;
            font-size: 0.8rem;
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid #e3e6f0;
        }

        .file-list {
            margin-top: 2rem;
        }

        .file-item {
            background: white;
            border: 1px solid #e3e6f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .file-info {
            display: flex;
            align-items: center;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: var(--roxo-claro);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--roxo-principal);
            margin-right: 1rem;
        }

        .file-details h6 {
            margin: 0;
            color: var(--roxo-escuro);
            font-weight: 600;
        }

        .file-details small {
            color: #6c757d;
        }

        .file-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-download {
            background: #17a2b8;
            border-color: #17a2b8;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .btn-download:hover {
            background: #138496;
            border-color: #117a8b;
            color: white;
        }

        .btn-edit {
            background: #28a745;
            border-color: #28a745;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .btn-edit:hover {
            background: #218838;
            border-color: #1e7e34;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            border-color: #dc3545;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .btn-delete:hover {
            background: #c82333;
            border-color: #bd2130;
            color: white;
        }

        .btn-send {
            background: var(--roxo-principal);
            border-color: var(--roxo-principal);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .btn-send:hover {
            background: var(--roxo-escuro);
            border-color: var(--roxo-escuro);
            color: white;
        }

        .back-link {
            color: var(--roxo-principal);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .back-link:hover {
            color: var(--roxo-escuro);
            text-decoration: none;
        }

        .progress-bar {
            background: var(--roxo-principal);
        }

        .upload-stats {
            background: var(--roxo-claro);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--roxo-principal);
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="home.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Quando Previd√™ncia</div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Tela Inicial -->
            <li class="nav-item">
                <a class="nav-link" href="home.html">
                    <i class="fas fa-fw fa-home"></i>
                    <span>Tela Inicial</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading" data-admin-only>
                Cadastros
            </div>

            <!-- Nav Item - Administradores -->
            <li class="nav-item" data-admin-only>
                <a class="nav-link" href="adm.html">
                    <i class="fas fa-fw fa-user-shield"></i>
                    <span>Administradores</span></a>
            </li>

            <!-- Nav Item - Gerentes -->
            <li class="nav-item" data-admin-only>
                <a class="nav-link" href="gerente.html">
                    <i class="fas fa-fw fa-user-tie"></i>
                    <span>Gerentes</span></a>
            </li>

            <!-- Nav Item - RH -->
            <li class="nav-item" data-admin-only>
                <a class="nav-link" href="rh.html">
                    <i class="fas fa-fw fa-users"></i>
                    <span>RH</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Recrutamento
            </div>

            <!-- Nav Item - Abertura de Vaga -->
            <li class="nav-item">
                <a class="nav-link" href="abertura-vaga.html">
                    <i class="fas fa-fw fa-plus-circle"></i>
                    <span>Abertura de Vaga</span></a>
            </li>

            <!-- Nav Item - Minhas Solicita√ß√µes -->
            <li class="nav-item">
                <a class="nav-link" href="minhas-solicitacoes.html">
                    <i class="fas fa-fw fa-clipboard-list"></i>
                    <span>Minhas Solicita√ß√µes</span></a>
            </li>

            <!-- Nav Item - Vagas -->
            <li class="nav-item">
                <a class="nav-link" href="vagas.html">
                    <i class="fas fa-fw fa-briefcase"></i>
                    <span>Vagas</span></a>
            </li>

            <!-- Nav Item - Upload Curr√≠culos -->
            <li class="nav-item active">
                <a class="nav-link" href="upload-curriculos.html">
                    <i class="fas fa-fw fa-file-upload"></i>
                    <span>Upload Curr√≠culos</span></a>
            </li>

            <!-- Nav Item - Candidatos -->
            <li class="nav-item">
                <a class="nav-link" href="candidatos.html">
                    <i class="fas fa-fw fa-user-friends"></i>
                    <span>Candidatos</span></a>
            </li>

            <!-- Nav Item - Match de Candidatos -->
            <li class="nav-item">
                <a class="nav-link" href="match-candidatos.html">
                    <i class="fas fa-fw fa-heart"></i>
                    <span>Match de Candidatos</span></a>
            </li>

            <!-- Nav Item - Kanban Recrutamento -->
            <li class="nav-item">
                <a class="nav-link" href="kanban-recrutamento.html">
                    <i class="fas fa-fw fa-columns"></i>
                    <span>Kanban Recrutamento</span></a>
            </li>

            <!-- Nav Item - Dashboard -->
            <li class="nav-item">
                <a class="nav-link" href="charts.html">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Carregando...</span>
                                <img class="img-profile rounded-circle" src="./img/undraw_profile.svg">
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Sair
                                </a>
                            </div>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Back Link -->
                    <a href="vagas.html" class="back-link">
                        <i class="fas fa-arrow-left mr-1"></i>
                        VOLTAR
                    </a>

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <div>
                            <h1 class="h3 mb-0 text-gray-800 page-title">Insira aqui os curr√≠culos para an√°lise</h1>
                            <!-- Informa√ß√£o da vaga selecionada -->
                            <div id="vagaInfo" class="mt-2" style="display: none;">
                                <span class="badge badge-primary" style="font-size: 0.9rem; padding: 8px 12px; background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);">
                                    <i class="fas fa-briefcase mr-1"></i>
                                    Vaga: <span id="vagaTitulo"></span>
                                </span>
                            </div>
                            <!-- Alerta se n√£o houver vaga selecionada -->
                            <div id="vagaAlerta" class="alert alert-danger mt-3" style="display: none;">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <strong>Aten√ß√£o:</strong> Nenhuma vaga selecionada. 
                                <a href="vagas.html" class="alert-link">Selecione uma vaga</a> antes de enviar curr√≠culos.
                            </div>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <!-- <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="upload-stats">
                                <div class="stat-item">
                                    <div class="stat-number">5</div>
                                    <div class="stat-label">Arquivos Enviados</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="upload-stats">
                                <div class="stat-item">
                                    <div class="stat-number">3</div>
                                    <div class="stat-label">Em An√°lise</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="upload-stats">
                                <div class="stat-item">
                                    <div class="stat-number">2</div>
                                    <div class="stat-label">Aprovados</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="upload-stats">
                                <div class="stat-item">
                                    <div class="stat-number">15.2</div>
                                    <div class="stat-label">MB Total</div>
                                </div>
                            </div>
                        </div>
                    </div> -->

                    <!-- Content Row -->
                    <div class="row">
                        <div class="col-xl-12 col-lg-12">
                            <div class="card shadow mb-4">
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-file-upload fa-fw"></i>
                                        Upload de Curr√≠culos
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <!-- Upload Area -->
                                    <div class="upload-area" id="uploadArea">
                                        <div class="upload-icon">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <div class="upload-text">Arraste os arquivos para fazer upload</div>
                                        <div class="upload-subtext">ou clique para selecionar arquivos</div>
                                        <div class="upload-formats">Formatos aceitos: PDF, PNG, JPG, JPEG, DOC, DOCX, RTF, TXT, ODT</div>
                                        <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.png,.jpg,.jpeg,.rtf,.txt,.odt"
                                            style="display: none;">
                                    </div>

                                    <!-- Progress Bar (hidden by default) -->
                                    <div class="progress mb-3" id="progressBar" style="display: none;">
                                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0"
                                            aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>

                                    <!-- File List -->
                                    <div class="file-list" id="fileList">
                                        <!-- File items will be added here dynamically -->
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="text-center">
                                        <button class="btn btn-send" id="sendBtn">
                                            <i class="fas fa-paper-plane mr-2"></i>
                                            Enviar Curr√≠culos
                                        </button>
                                        <button class="btn btn-delete" id="deleteAllBtn" disabled
                                            style="margin-left: 10px;">
                                            <i class="fas fa-trash mr-2"></i>
                                            Excluir Todos
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Quando Previd√™ncia 2024</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content"
                style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <div class="modal-body text-center p-4">
                    <button type="button" class="close position-absolute"
                        style="top: 15px; right: 20px; font-size: 24px; color: #000;" data-dismiss="modal"
                        aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div class="mb-4">
                        <div
                            style="width: 80px; height: 80px; background: #10b981; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                            <i class="fas fa-check" style="font-size: 40px; color: white;"></i>
                        </div>
                    </div>
                    <h4 class="mb-3" style="color: #1f2937; font-weight: 600;">Curr√≠culos Enviados com Sucesso!</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content"
                style="border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <div class="modal-body text-center p-4">
                    <button type="button" class="close position-absolute"
                        style="top: 15px; right: 20px; font-size: 24px; color: #000;" data-dismiss="modal"
                        aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div class="mb-4">
                        <div
                            style="width: 80px; height: 80px; background: #ef4444; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                            <i class="fas fa-trash" style="font-size: 40px; color: white;"></i>
                        </div>
                    </div>
                    <h4 class="mb-4" style="color: #1f2937; font-weight: 600;" id="deleteModalText">Deseja excluir os
                        envios?</h4>
                    <div class="d-flex justify-content-center gap-3">
                        <button type="button" class="btn btn-primary px-4 py-2"
                            style="background: #7c3aed; border: none; border-radius: 8px; font-weight: 500;"
                            data-dismiss="modal">N√£o</button>
                        <button type="button" class="btn btn-danger px-4 py-2"
                            style="background: #ef4444; border: none; border-radius: 8px; font-weight: 500;"
                            id="confirmDelete">Sim</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Pronto para sair?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">√ó</span>
                    </button>
                </div>
                <div class="modal-body">Selecione "Sair" abaixo se voc√™ estiver pronto para encerrar sua sess√£o atual.
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancelar</button>
                    <button class="btn btn-primary" type="button" onclick="handleLogout()">Sair</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level custom scripts -->
    <script>
        // ==========================================
        // CONFIGURA√á√ÉO DE VAGA SELECIONADA
        // ==========================================
        let selectedVacancyId = null;
        let selectedVacancyTitle = null;

        // Verifica se h√° vaga selecionada ao carregar a p√°gina
        function checkSelectedVacancy() {
            selectedVacancyId = localStorage.getItem('selectedVacancyId');
            selectedVacancyTitle = localStorage.getItem('selectedVacancyTitle');
            
            console.log('üìã [upload-curriculos] Verificando vaga selecionada...');
            console.log('üìã [upload-curriculos] ID da vaga:', selectedVacancyId);
            console.log('üìã [upload-curriculos] T√≠tulo da vaga:', selectedVacancyTitle);
            
            if (selectedVacancyId) {
                // Mostra informa√ß√£o da vaga
                $('#vagaInfo').show();
                $('#vagaTitulo').text(selectedVacancyTitle || `ID: ${selectedVacancyId}`);
                $('#vagaAlerta').hide();
                $('#sendBtn').prop('disabled', false);
                console.log('‚úÖ [upload-curriculos] Vaga selecionada encontrada. Upload habilitado.');
            } else {
                // Mostra alerta e desabilita upload
                $('#vagaInfo').hide();
                $('#vagaAlerta').show();
                $('#sendBtn').prop('disabled', true);
                console.warn('‚ö†Ô∏è [upload-curriculos] NENHUMA VAGA SELECIONADA! Upload bloqueado.');
            }
        }

        $(document).ready(function () {
            // Verifica vaga selecionada
            checkSelectedVacancy();
            
            let uploadedFiles = [];


            // Upload area click (s√≥ dispara se n√£o clicar em bot√£o dentro do uploadArea)
            $('#uploadArea').on('click', function (e) {
                // Evita conflito se clicar em bot√£o dentro do uploadArea
                if ($(e.target).is('button') || $(e.target).is('input') || $(e.target).closest('.file-actions').length) {
                    return;
                }
                $('#fileInput')[0].click();
            });

            // File input change
            $('#fileInput').on('change', function (e) {
                handleFiles(e.target.files);
                // Limpa o input para permitir reenvio do mesmo arquivo
                $(this).val('');
            });

            // Drag and drop functionality
            $('#uploadArea').on('dragover', function (e) {
                e.preventDefault();
                $(this).addClass('dragover');
            });

            $('#uploadArea').on('dragleave', function (e) {
                e.preventDefault();
                $(this).removeClass('dragover');
            });

            $('#uploadArea').on('drop', function (e) {
                e.preventDefault();
                $(this).removeClass('dragover');
                handleFiles(e.originalEvent.dataTransfer.files);
            });

            // Handle file uploads
            function handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (isValidFile(file)) {
                        // Evita arquivos duplicados pelo nome
                        if (!uploadedFiles.some(f => f.name === file.name && f.size === file.size)) {
                            uploadedFiles.push(file);
                            addFileToList(file);
                        }
                    } else {
                        alert('Formato de arquivo n√£o suportado: ' + file.name);
                    }
                });
                updateSendButton();
            }

            // Validate file type
            function isValidFile(file) {
                const validTypes = [
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'image/png',
                    'image/jpeg',
                    'image/jpg',
                    'application/rtf',
                    'text/plain',
                    'application/vnd.oasis.opendocument.text'
                ];
                return validTypes.includes(file.type);
            }

            // Add file to list
            function addFileToList(file) {
                const iconClass = file.type.includes('pdf') ? 'fa-file-pdf' : file.type.includes('word') ? 'fa-file-word' : file.type.includes('image') ? 'fa-file-image' : 'fa-file-alt';
                const fileItem = $(`
                    <div class="file-item" data-file="${file.name}">
                        <div class="file-info">
                            <div class="file-icon">
                                <i class="fas ${iconClass}"></i>
                            </div>
                            <div class="file-details">
                                <h6>${file.name}</h6>
                                <small>${formatFileSize(file.size)}</small>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn btn-download btn-sm" onclick="downloadFile('${file.name}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-edit btn-sm" onclick="editFile('${file.name}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-delete btn-sm" onclick="deleteFile('${file.name}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `);
                $('#fileList').append(fileItem);
            }

            // Format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // Update send button
            function updateSendButton() {
                // S√≥ habilita se tiver arquivos E vaga selecionada
                if (uploadedFiles.length > 0 && selectedVacancyId) {
                    $('#sendBtn').prop('disabled', false);
                    $('#deleteAllBtn').prop('disabled', false);
                } else {
                    // Se n√£o tem vaga, sempre desabilita o envio
                    $('#sendBtn').prop('disabled', !selectedVacancyId || uploadedFiles.length === 0);
                    $('#deleteAllBtn').prop('disabled', uploadedFiles.length === 0);
                }
            }

            // Send files (upload)
            $('#sendBtn').on('click', async function () {
                // ==========================================
                // VALIDA√á√ÉO OBRIGAT√ìRIA: VAGA SELECIONADA
                // ==========================================
                if (!selectedVacancyId) {
                    console.error('‚ùå [upload-curriculos] ERRO: Tentativa de upload sem vaga selecionada!');
                    alert('Erro: Selecione uma vaga antes de enviar curr√≠culos.\n\nV√° para a tela de Vagas Dispon√≠veis e clique em "Enviar Curr√≠culo" na vaga desejada.');
                    window.location.href = 'vagas.html';
                    return;
                }
                
                if (uploadedFiles.length === 0) return;
                
                console.log('üì§ [upload-curriculos] Iniciando upload de', uploadedFiles.length, 'arquivo(s)');
                console.log('üì§ [upload-curriculos] Vaga vinculada:', selectedVacancyId, '-', selectedVacancyTitle);
                
                $('#progressBar').show();
                let progress = 0;
                const total = uploadedFiles.length;
                let successCount = 0;
                let errorCount = 0;
                
                for (let i = 0; i < total; i++) {
                    const file = uploadedFiles[i];
                    try {
                        console.log(`üì§ [upload-curriculos] Enviando arquivo ${i + 1}/${total}: ${file.name}`);
                        await uploadSingleFile(file, selectedVacancyId);
                        successCount++;
                        console.log(`‚úÖ [upload-curriculos] Arquivo ${file.name} enviado com sucesso para vaga ${selectedVacancyId}`);
                    } catch (err) {
                        errorCount++;
                        console.error(`‚ùå [upload-curriculos] Erro ao enviar ${file.name}:`, err);
                    }
                    progress = Math.round(((i + 1) / total) * 100);
                    $('.progress-bar').css('width', progress + '%').attr('aria-valuenow', progress);
                }
                
                setTimeout(() => {
                    $('#progressBar').hide();
                    if (successCount > 0) {
                        console.log(`‚úÖ [upload-curriculos] Upload conclu√≠do! ${successCount} arquivo(s) enviado(s) para vaga ${selectedVacancyId}`);
                        $('#successModal').modal('show');
                        
                        // Limpa a vaga selecionada ap√≥s upload bem-sucedido
                        localStorage.removeItem('selectedVacancyId');
                        localStorage.removeItem('selectedVacancyTitle');
                    }
                    if (errorCount > 0) {
                        alert(errorCount + ' arquivo(s) falharam no upload.');
                    }
                    uploadedFiles = [];
                    $('#fileList').empty();
                    updateSendButton();
                }, 500);
            });

            // Global functions for file actions
            window.downloadFile = function (fileName) {
                alert('Download: ' + fileName);
            };

            window.editFile = function (fileName) {
                alert('Editar: ' + fileName);
            };

            window.deleteFile = function (fileName) {
                window.fileToDelete = fileName;
                window.deleteAll = false;
                $('#deleteModalText').text('Deseja excluir este arquivo?');
                $('#deleteModal').modal('show');
            };

            // Confirm delete action
            $('#confirmDelete').on('click', function () {
                if (window.fileToDelete) {
                    uploadedFiles = uploadedFiles.filter(file => file.name !== window.fileToDelete);
                    $(`.file-item[data-file="${window.fileToDelete}"]`).remove();
                    updateSendButton();
                    window.fileToDelete = null;
                } else if (window.deleteAll) {
                    uploadedFiles = [];
                    $('#fileList').empty();
                    updateSendButton();
                    window.deleteAll = false;
                }
                $('#deleteModal').modal('hide');
            });

            // Delete all files
            $('#deleteAllBtn').on('click', function () {
                window.deleteAll = true;
                window.fileToDelete = null;
                $('#deleteModalText').text('Deseja excluir os envios?');
                $('#deleteModal').modal('show');
            });
        });

        // ------------------------------------------------------------------------------------------------------

    // Fun√ß√£o para upload de um arquivo individual COM vacancyId
    async function uploadSingleFile(file, vacancyId) {
        // ==========================================
        // VALIDA√á√ÉO: vacancyId √© OBRIGAT√ìRIO
        // ==========================================
        if (!vacancyId) {
            console.error('‚ùå [uploadSingleFile] ERRO CR√çTICO: vacancyId n√£o fornecido!');
            throw new Error("vacancyId √© obrigat√≥rio para upload de curr√≠culo");
        }
        
        console.log(`üì§ [uploadSingleFile] Iniciando upload: ${file.name}`);
        console.log(`üì§ [uploadSingleFile] vacancyId: ${vacancyId}`);
        
        const allowedMimeTypes = [
            "application/pdf",
            "image/jpeg",
            "image/jpg",
            "image/png",
            "application/msword",
            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            "application/rtf",
            "text/plain",
            "application/vnd.oasis.opendocument.text"
        ];
        
        const mimeType = file.type;
        if (!allowedMimeTypes.includes(mimeType)) {
            throw new Error("Tipo de arquivo n√£o suportado: " + file.name);
        }
        
        // ==========================================
        // ESTRAT√âGIA 1: Enviar para backend com vacancyId
        // ==========================================
        // const backendUrl = 'http://3.92.226.132:8080'; // Produ√ß√£o
        const backendUrl = 'http://localhost:8080';
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('vacancyId', vacancyId);
        
        console.log(`üì§ [uploadSingleFile] Enviando para backend: ${backendUrl}/candidates/upload?vacancyId=${vacancyId}`);
        
        try {
            const response = await fetch(`${backendUrl}/candidates/upload?vacancyId=${vacancyId}`, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error(`‚ùå [uploadSingleFile] Erro do backend:`, response.status, errorText);
                throw new Error('Erro no upload: ' + errorText);
            }
            
            const result = await response.json();
            console.log(`‚úÖ [uploadSingleFile] Resposta do backend:`, result);
            console.log(`‚úÖ [uploadSingleFile] Matching ser√° feito APENAS para vaga ${vacancyId}`);
            return result;
            
        } catch (backendError) {
            console.warn(`‚ö†Ô∏è [uploadSingleFile] Backend falhou, tentando S3 direto:`, backendError.message);
            
            // ==========================================
            // ESTRAT√âGIA 2 (FALLBACK): Upload direto para S3
            // ATEN√á√ÉO: Este m√©todo N√ÉO faz matching autom√°tico!
            // ==========================================
            const baseUrl = 'https://x7cmx55txd.execute-api.us-east-1.amazonaws.com/prd/files/quando-contratar-bucket-raw/';
            
            // Adiciona prefixo com vacancyId no nome do arquivo para rastreabilidade
            const timestamp = Date.now();
            const fileNameWithVacancy = `vacancy_${vacancyId}_${timestamp}_${file.name}`;
            
            console.log(`üì§ [uploadSingleFile] Fallback S3: ${fileNameWithVacancy}`);
            console.warn(`‚ö†Ô∏è [uploadSingleFile] ATEN√á√ÉO: Upload S3 n√£o faz matching autom√°tico!`);
            
            const options = {
                method: 'PUT',
                body: file,
                headers: { 'Content-Type': mimeType }
            };
            
            const s3Response = await fetch(baseUrl + fileNameWithVacancy, options);
            if (!s3Response.ok) {
                const text = await s3Response.text();
                throw new Error('Erro S3: ' + text);
            }
            
            console.log(`‚úÖ [uploadSingleFile] Arquivo enviado para S3: ${fileNameWithVacancy}`);
            console.warn(`‚ö†Ô∏è [uploadSingleFile] Matching precisar√° ser feito manualmente pelo backend`);
            return { success: true, method: 's3', fileName: fileNameWithVacancy, vacancyId: vacancyId };
        }
    }
    </script>
    <script src="./assets/js/components/utils.js"></script>
    <script src="./assets/js/components/permissions.js"></script>
    <script src="./assets/js/components/auth.js"></script>
    <script>
      $(document).ready(function() {
        if (window.Utils) {
          Utils.updateUserName();
        }
      });
    </script>

</body>

</html>